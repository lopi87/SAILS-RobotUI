<h1 class="text-center login-title marginbottom20 margintop20"><%= i18n('permissions')%></h1>

<% if(perm.size == 0){ %>
<div class="alert alert-info margintop20 marginbottom20" role="alert">
  <strong>Ups!</strong>
  This robot is private.
</div>
<% } else { %>


<div class="row">
  <div class="col-md-6">
    <div class="control-group">
      <label for="name"><%= i18n("public") %> * :</label>
      <p class="paddingtop10">
        <%= i18n('control') + ':' %><input class="i-checks pr-2" name="public_drive" type="checkbox" checked="<%= robot.public_drive %>">
        <%= i18n('view') + ':' %><input class="i-checks pr-2" name="public_view" type="checkbox" checked="<%= robot.public_view %>">
      </p>
    </div>
  </div>


  <div class="row">
    <div class="col-md-10 col-md-offset-1">
      <table class="table table-hover">
        <thead>
        <tr>
          <th>Avatar</th>
          <th>Username</th>
          <th>Drive</th>
          <th>View</th>
          <th>Actions</th>
        </tr>
        </thead>
        <tbody id="actualizar">

        <% Object.keys(perm).forEach(function (key) { %>
        <tr id="perm_<%= key %>">

          <td><img src="<%= sails.getBaseUrl() + perm[key].avatarUrl %>" alt="Avatar" title="<%= perm[key].name %>" class="card-left card-circle card-margin-right img-responsive" style="width:32px"></td>
          <td> <%= perm[key].name %></td>

          <% if(perm[key].d){ %>
          <td> <img src="/images/online.png" height="30" width="30"></td>
          <% } else { %>
          <td> <img src="/images/offline.png" height="30" width="30"></td>
          <% } %>

          <% if(perm[key].v){ %>
          <td> <img src="/images/online.png" height="30" width="30"></td>
          <% } else { %>
          <td> <img src="/images/offline.png" height="30" width="30"></td>
          <% } %>
          <td> <a class="btn btn-sm btn-danger" onclick="delete_row_permissions('<%= robot.id %>', '<%= key %>')">Delete</a></td>
        </tr>
        <% }) %>
        </tbody>
      </table>
      <% } %>

    </div>
  </div>

  <div class="clear"></div>

  <div class="row">
    <div class="col-md-12">
      <hr class="margintop20">
      <div class="row">
        <div class="col-lg-12 marginbottom10">
          <div class="control-group">
            <p><label for="user"><%= i18n("users") %> * :</label></p>
            <select tabindex="-1" multiple="" data-placeholder="Choose users..." class="chzn-select" name="users">
              <option value=""></option>
              <% users.forEach(function(user)  { %>
              <option data-img-src="<%= sails.getBaseUrl() + user.avatarUrl %>" value="<%= user.id %>"><%= user.name %></option>
              <% }); %>
            </select>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <div class="control-group">
            <label for="name"><%= i18n("actions") %> * :</label>
            <p class="paddingtop10">
              Control: <input class="i-checks pr-2" name="control_check" type="checkbox">
              View: <input class="i-checks pr-2" name="view_check" type="checkbox">
            </p>
          </div>
        </div>

        <div class="col-md-6 margintop10">
          <a id="down_bottom" class="btn btn-lg btn-block btn-success margintop10" onclick="new_permissions('<%= robot.id %>')"><%= i18n('add') %></a>
        </div>
      </div>
    </div>
  </div>
</div>


<script type="text/javascript">

  function new_permissions(id) {
    $.ajax({
      url: '/robot/new_permissions/' + id,
      type: 'GET',
      data: {users: $(".chzn-select").val(), control_check: $('input[name=control_check]:checked').val(), view_check: $('input[name=view_check]:checked').val()},
      done:function() {
      },

      success: function(data){
        $('#actualizar').html(data);
        toastr.info('The new permissions has been added!', 'Permissions' );
      },

      error: function(data) {
        show_errors(data.responseText);
      }
    });
  }


  function delete_row_permissions(robot_id, user_id){
    $.ajax({
      url: '/robot/delete_permission/' + robot_id,
      type: 'GET',
      data: {user_id: user_id},
      done:function() {
      },

      success: function(data){
        $("#perm_" + user_id).remove();
       toastr.info('Permissions user has been deleted!', 'Robot' );
      },

      error: function(data) {
        show_errors(data.responseText);
      }
    });
  }


</script>





