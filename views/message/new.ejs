<form id="msg-form" class="form-signin" action="create" method="post" data-parsley-validate style="max-width: none">
  <div class="control-group">
    <label for="name">Title * :</label>
    <input class="form-control" name="title" placeholder="your title"  type="text" required="">
  </div>

  <div class="control-group">
    <label for="type">To: *</label>
    <select data-placeholder="Choose users..." class="chosen-select-users" tabindex="2" name="to_user_id">
      <option value=""></option>
      <% users.forEach(function(user)  { %>
      <option data-img-src="<%= sails.getBaseUrl() + user.avatarUrl %>" value="<%= user.id %>"><%= user.name %></option>
      <% }); %>
    </select>
    <script type="text/javascript">
      $('.chosen-select-users').chosen( { width: '100%', height:'20px' } );
    </script>
  </div>

  <div class="form-group">
    <label for="message">Message (20 chars min, 100 max)* :</label>
    <textarea id="message" class="form-control" name="message" data-parsley-trigger="keyup" data-parsley-minlength="20" data-parsley-maxlength="100" data-parsley-minlength-message="Come on! You need to enter at least a 20 character comment.." data-parsley-validation-threshold="10"></textarea>
  </div>

  <!--
      <div class="form-group">
        <label for="human" class="col-sm-1 control-label">2 + 3 = ?</label>
        <div class="col-sm-10">
          <input type="text" class="form-control" id="human" name="human" placeholder="Your Answer">
        </div>
      </div>
      <div class="form-group">
        <div class="button_right">
          <input id="submit_msg" name="submit" type="submit" value="Send" class="btn btn-primary">
        </div>
      </div>
  -->

  <input type="hidden" name="_csrf" value="<%= _csrf %>">
</form>



<script type="text/javascript">
  addLoadEvent(set_parsley_lang('<%= (typeof(req.session) !== 'undefined' && req.session.languagePreference) ? req.session.languagePreference : sails.config.i18n.defaultLocale  %>'));

  function submit_function() {
    $('#msg-form').parsley().validate()
    var ok = $('.parsley-error').length === 0;

    if (true){
      $.ajax({
        url: '/message/send/' + '<%= session.User.id %>',
        type: 'GET',
        data: {

        },

        success: function (data) {
          $("#errors_container").html('');
          $("#panel").append(data);
          $('.modal').modal('toggle');
         toastr.info('A new message has been send!', 'Message');
        },

        error: function (xhr) {
          $("#errors_container").html('<p class="bg-danger">' + xhr.responseText + '</p>');
          //bootstrap_alert['danger'](xhr.responseText, 5000);
        }
      });

    }
  }

</script>
