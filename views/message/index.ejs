<div class="jumbox">
  <div class="wrapper wrapper-content">
    <div class="row">
      <div class="col-lg-3">
        <div class="ibox float-e-margins">
          <div class="ibox-content mailbox-content">
            <div class="file-manager">
              <div class="space-25"></div>
              <h5>Folders</h5>
              <ul class="folder-list m-b-md" style="padding: 0">
                <li><a href=""> <i class="fa fa-inbox "></i> Inbox <span class="label label-warning pull-right">16</span> </a></li>
                <li><a href=""> <i class="fa fa-envelope-o"></i> Send Mail</a></li>
                <li><a href=""> <i class="fa fa-certificate"></i> Important</a></li>
                <li><a href=""> <i class="fa fa-file-text-o"></i> Drafts <span class="label label-danger pull-right">2</span></a></li>
                <li><a href=""> <i class="fa fa-trash-o"></i> Trash</a></li>
              </ul>
              <div class="clearfix"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-9 animated fadeInRight">
        <div class="mail-box-header">
          <div class="pull-right tooltip-demo">
            <a href="" class="btn btn-white btn-sm" data-toggle="tooltip" data-placement="top" title="Move to draft folder"><i class="fa fa-pencil"></i> Draft</a>
            <a href="" class="btn btn-danger btn-sm" data-toggle="tooltip" data-placement="top" title="Discard email"><i class="fa fa-times"></i> Discard</a>
          </div>
          <h2>
            <%= i18n("messages") %>
          </h2>
        </div>
        <form id="msg-form" class="form-horizontal" action="send" method="post" enctype="multipart/form-data">
          <div class="mail-box">
            <div class="mail-body">
              <input type="hidden" name="_csrf" value="<%= _csrf %>">

              <div class="form-group">
                <label class="col-sm-2 control-label"><%= i18n("to") + ': ' %> </label>
                <div class="col-sm-10">
                  <select data-placeholder="Choose users..." class="chosen-select-users" tabindex="2" name="to_user_id">
                    <option value=""></option>
                    <% users.forEach(function(user)  { %>
                    <option data-img-src="<%= sails.getBaseUrl() + user.avatarUrl %>" value="<%= user.id %>"><%= user.name %></option>
                    <% }); %>
                  </select>
                  <script type="text/javascript">
                    $('.chosen-select-users').chosen( { width: '100%', height:'20px' } );
                  </script>
                </div>
              </div>

              <div class="form-group">
                <label class="col-sm-2 control-label"><%= i18n("subject") + ': ' %></label>
                <div class="col-sm-10"><input type="text" class="form-control" name="title" value=""></div>
              </div>
            </div>

            <div class="form-group">
              <label for="message">Message (20 chars min, 100 max)* :</label>
              <textarea id="message" class="summernote" name="content"></textarea>
            </div>

            <div class="mail-body text-right tooltip-demo">
              <a href='#' onclick="document.getElementById('msg-form').submit()" class="btn btn-sm btn-primary" type="submit"  data-toggle="tooltip" data-placement="top"> <i class="fa fa-reply"></i> <span><%= i18n('send') %></span></a>
              <a href="" class="btn btn-white btn-sm" data-toggle="tooltip" data-placement="top" title="Discard email"><i class="fa fa-times"></i> Discard</a>
              <a href="" class="btn btn-white btn-sm" data-toggle="tooltip" data-placement="top" title="Move to draft folder"><i class="fa fa-pencil"></i> Draft</a>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!--<div class="mail-text h-200">-->
    <!--<div class="summernote">-->
      <!--<h3>Hello Jonathan! </h3>-->
      <!--dummy text of the printing and typesetting industry. <strong>Lorem Ipsum has been the industry's</strong> standard dummy text ever since the 1500s,-->
      <!--when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic-->
      <!--typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with-->
      <!--<br/>-->
      <!--<br/>-->
    <!--</div>-->
  <!--</div>-->


  <%- partial('_table.ejs')%>

</div>


<script type="text/javascript">

  function msg_as_read(id) {

    $.ajax({
      url: '/message/markasread/' + id,
      type: 'GET',
      data: {},
      success: function () {
        var env_id = '#env_' + id;
        $(env_id).html('<i class="fa fa-eye fa-2x" aria-hidden="true"></i>');
        var read_btn = '#mark_read_btn_' + id;
        $(read_btn).remove();


        // Update num msg
        var num_msg = document.getElementById('msg_new').innerHTML.replace('+','');
        num_msg--;
        $('#buttom_msg').html('<a href="/message/index">Messages <span id="msg_new" class="label label-pill label-danger">' + '+' + num_msg + '</span></a>');
       toastr.info('', 5000 );

      },

      error: function (xhr, status, text) {
        bootstrap_alert['danger'](xhr.responseText, 5000 );
      }
    });
  }

  function destroy_msg(id) {
    $.ajax({
      url: '/message/destroy/',
      type: 'GET',
      data: {id: id},

      success: function (data) {
        $("#line_msg_" + id).remove();
       toastr.info('The message has been deleted!', 'Message' );
      },

      error: function (xhr, status, text) {
        bootstrap_alert['danger'](xhr.responseText, 5000 );
      }
    });
  }



  function new_message(action, title){
    $.ajax({
      url: action,
      type: 'GET',
      data: {id: '<%= session.User.id %>'},
      success: function(data){
        $("#errors_container").html('');
        $('#myModalLabel').html(title)
        $("#container").html(data);
      }
    });
  }

  function subscribeAndListen() {
    io.socket.get('/message/message_subscribe');
  }

</script>
