<div class="container">
  <div class="page-header -align-center">
    <h1>Mandar comandos <small> <%= robot.name %> </small></h1>
  </div>

  <div id="content" class="row">
    <div class="col-md-2"></div>
    <div id="cahtContent" class="col-md-8">
      <div class="panel panel-success">
        <div class="panel-heading">
          Comandos
        </div>
        <div id="chat" class="panel-body" style="min-height: 250px; max-height: 250px; overflow-y: scroll;"></div>
      </div>
      <div>
        <form id="sendMessage" class="input-group" style="text-align: center; margin:0 auto;">
          <input id="message" class="form-control input-lg" type="text">
        <span class="input-group-btn">
          <button class="btn btn-lg btn-primary" type="submit">Mandar</button>
        </span>
        </form>
      </div>
    <div class="col-md-2"></div>
    </div>
  </div>
</div>


<script type="text/javascript">

  //Subscribimos
  addLoadEvent(subscribeAndListen());

  function subscribeAndListen() {
    alert('subscribeAndListen');
    io.socket.get('/interface/commandline/',{robot: '<%= robot.id%>'});
    var $chat = $('#chat');

    io.socket.on('interface', function (obj) {
      if (obj.verb == 'created') {
        var data = obj.data;
        console.log('Command ' + data.command + ' ' + data.id +' has been send.');
        $chat.append(' - ' + data.command + '<br/>');

      }
    });
  }


  //Mandar evento "mandar comando" al servidor para sincronizar con otros navegadores
  var $messageForm = $('#sendMessage');
  $messageForm.submit(function (e) {
    var $message = $('#message');
    e.preventDefault();
    if($message.val() != '' ) io.socket.get('/interface/commandline/',{interface: '<%= interface.id %>' ,user_id: '<%= session.User.id%>'   ,command: $message.val()});
    $message.val('');
    command_send('interface', $message.val())
  });


  //PENDIENTE DE MIRAR EVENTOS PARA LOS BOTONES
  //emite el comando de los botones creados en la interfaz
  var interface_buttons = $('[id^=button_]');
  interface_buttons.click(function (){
    var button_pressed_id = this.id.replace('button_','');
    var code = document.getElementById(this.id).value

    io.socket.get('/interface/commandline/',{interface: '<%= interface.id %>' ,user_id: '<%= session.User.id%>', button: button_pressed_id});

    if (code != ''){
      command_send('interface',code);
    }
    //Emitir al servidor la accion para sincronizar con el resto de clientes....
    //Mandar evento al servidor para sincronizar con otros navegadores
  });


</script>
