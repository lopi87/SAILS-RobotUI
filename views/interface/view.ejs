<%- partial('../_alert.ejs', {flash: flash}) %>


<div class="text-center marginbottom20">
  <h1>Control panel <small> <%= robot.name %> </small></h1>
</div>

<div id="board" class="panel panel-success margintop20">
  <div class="panel-heading">
    <img style="max-width:150px;" src="/images/logo/logotipo.png">
    <a href="#" onclick="openWin(200,200,'board')"><i class="fa fa-external-link fa-2x floatright" style="height: 20px"></i></a>
  </div>

  <div class="paddingtop20 paddingleft20 paddingright20">
    <div>
      <div class="col-md-1">
        <div class="bottom_col">
          <div class="list-group">
            <a class="list-group-item"><i class="fa fa-plus fa-2 marginlef10" aria-hidden="true"></i>&nbsp;</a>
            <a class="list-group-item"><i class="fa fa-remove fa-2 marginlef10" aria-hidden="true"></i>&nbsp;</a>
            <a class="list-group-item" href="/interface/configure/<%= interface.id %>" data-toggle="tooltip" data-placement="top" title="Edit board"><i class="fa fa-edit fa-2 marginlef10" aria-hidden="true"></i>&nbsp;</a>
            <a class="list-group-item"><i class="fa fa-plug fa-2 marginlef10" aria-hidden="true"></i>&nbsp;</a>
            <a class="list-group-item"><i class="fa fa-cog fa-2 marginlef10" aria-hidden="true"></i>&nbsp;</a>
          </div>
        </div>
      </div>

      <div id="box_panel" class="col-md-11">
        <div id="panel" class="panel_resizable work">

          <!-- Insert video -->
          <% if (interface.has_video){%>
          <% _.each(videos, function(video){ %>
          <img id="play_<%= video.id %>" class="img-responsive play_<%= video.id %> position_<%= video.id %>" src="/images/video/video.png" width="400" height="300">
          <%- partial ('../video/style_video.ejs', {video: video})%>
          <% })%>
          <%}%>

          <!-- Insert actions -->
          <% _.each(actions, function(action){ %>
          <% if (action.icon){ %>
          <button id="button_custom_<%= action.id %>" class="btn position_<%= action.id %> btn-custom_<%= action.id %>" value="<%= action.code %>">
            <img src="/uploads/icons/<%= action.icon %>.png" />
            <% if (action.name != ''){%>
            <%= action.name %>
            <% }%>
          </button>
          <% } else { %>
          <button  id="button_<%= action.id %>" value="<%= action.code %>" class="btn position_<%= action.id %> btn-custom_<%= action.id %>"><%= action.name %></button>
          <% } %>
          <%- partial ('../action/style_action.ejs', {action: action})%>
          <% })%>


          <!-- Insert events -->
          <% _.each(events, function(event){ %>
          <div id="event_<%= event.id %>" class="event_<%= event.id %> position_<%= event.id %>" style="max-width: 100px">
            <h5><%= event.name %> <span class="label label-pill label-danger">-</span></h5>
          </div>
          <%- partial ('../event/style_event.ejs', {event: event})%>
          <% })%>

       </div>
      </div>
    </div>
    <script type="text/javascript">
      $( "#panel").width(<%= interface.panel_sizex %>);
      $( "#panel").height(<%= interface.panel_sizey %>);
    </script>
    <div class="row">
      <div class="col-md-12 col-sm-12">
        <div class="marginright20 margintop10 marginbottom10 floatright">
          <!--
          <a id="save_dash" class="btn btn-sm btn-success" > Save dashboard! </a>
          <a id="edit_dash" class="btn btn-sm btn-warning" > Edit dashboard! </a>
          <a id="reset_dash" class="btn btn-sm btn-danger" > Reset dashboard! </a>
        -->
        </div>
      </div>
    </div>
  </div>
</div>

<div class="pull-right margintop20 marginbottom20">
  <a href="/robot/index" class="btn btn-sm btn-warning">Back</a>
</div>

<% partial ('commands.ejs', {robot: robot})%>


<script src="/socket.io/socket.io.js"></script>
<script type="text/javascript">

  //Subscribimos
  addLoadEvent(subscribeAndListen());

  function subscribeAndListen() {
    io.socket.get('/interface/view_subscribe/',{robot: '<%= robot.id%>'});

    io.socket.on('message', function (obj) {
      //EVENTOS CAPURADOS
      switch (obj.type) {
        case 'action':
          alert('action ' + 'id: ' + obj.id + ' msg: ' + obj.msg);
          break;

        case 'event':
          alert('event ' + 'id: ' + obj.id + ' msg: ' + obj.msg);
          break;

        case 'new_viewer_user':
          alert('new viewer user');
          break;

        case 'video':
          alert('new video frame');
          break;


        default:
          break;
      }
    });
  }



</script>
