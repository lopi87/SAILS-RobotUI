<form id="action-form" class="form-signin" action="" method="post" data-parsley-validate style="max-width: none">
  <div class="row">
      <div class="col-md-5 col-md-offset-1">

        <div class="control-group marginbottom5">
          <label for="name"><%= i18n("name") %> * :</label>
          <input id="name_field" type="text" class="form-control" value="<%= action.name %>" placeholder="<%= i18n("name") %> name="name">
        </div>

        <div class="control-group marginbottom5">
          <label for="name"><%= i18n("code") %> * :</label>
          <input id="code_field" type="text" class="form-control" value="<%= action.code %>" placeholder="<%= i18n("code") %>" required="" name="code">
        </div>

        <div class="control-group marginbottom5">
          <label for="icon"><%= i18n("selectanicon") %> *:</label>
          <div>
            <select id="slect_icon" data-placeholder="<%= i18n("selectanicon") %>" class="chzn-select-icon" tabindex="2" style="width: 100%">
              <option value=""></option>
              <% _.each(icons, function(icon){ %>
              <% if (action.icon == icon.id ){ %>
              <option data-img-src="<%= icon.iconUrl %>" value="<%= icon.id %>" selected><%= icon.name %></option>
              <% } else { %>
              <option data-img-src="<%= icon.iconUrl %>" value="<%= icon.id %>"><%= icon.name %></option>
              <% } %>
              <% })%>
            </select>
          </div>
          <script type="text/javascript">
            $('.chzn-select-icon').chosen({ width: '100%', disable_search: true });
          </script>
        </div>

        <div class="control-group marginbottom5">
          <label for="name"><%= i18n("color") %> * :</label>
          <p>
            <%= i18n('custom') %>: <input name="color_default" id="custom" value="false" type="checkbox" onchange="enable_colorform()">
          </p>
        </div>
        <script type="text/javascript">
          function enable_colorform(){
            if($("#custom").is(':checked')) {
              $('#colorform').show();
            } else {
              $('#colorform').hide();
            }
          }
        </script>

      </div>
      <div class="col-md-5">

        <div id="colorform" style="display:none">
          <div class="control-group">
            <label for="colortext"><%= i18n("text") %> * :</label>
            <div class="input-group colorpicker-component ">
              <input id="text_field" type="text" class="form-control" value="<%= action.color_text %>" />
              <span class="input-group-addon"><i></i></span>
            </div>
          </div>

          <div class="control-group">
            <label for="colorbackground"><%= i18n("background") %> * :</label>
            <div class="input-group colorpicker-component ">
              <input id="background_field" type="text" class="form-control" value="<%= action.color_background %>" />
              <span class="input-group-addon"><i></i></span>
            </div>
          </div>

          <div class="control-group">
            <label for="colorbordert"><%= i18n("border") %> * :</label>
            <div class="input-group colorpicker-component ">
              <input id="border_field" type="text" class="form-control" value="<%= action.color_border %>" />
              <span class="input-group-addon"><i></i></span>
            </div>
          </div>

          <div class="control-group">
            <label for="colorbordert"><%= i18n("activebackground") %> * :</label>
            <div class="input-group colorpicker-component ">
              <input id="active_background_field" type="text" class="form-control" value="<%= action.color_active_background %>" />
              <span class="input-group-addon"><i></i></span>
            </div>
          </div>
        </div>
      </div>
  </div>
  <input id="action_csrf" type="hidden" name="_csrf" value="<%= _csrf %>" />
</form>

<script type="text/javascript">
  addLoadEvent(set_parsley_lang('<%= (typeof(req.session) !== 'undefined' && req.session.languagePreference) ? req.session.languagePreference : sails.config.i18n.defaultLocale  %>'));

  function submit_function() {
    $('#action-form').parsley().validate()
    var ok = $('.parsley-error').length === 0;

    if (ok){
      $.ajax({
        url: '/action/update/' + '<%= action.id %>',
        type: 'GET',
        data: {
          name: $("#name_field").val(),
          code: $("#code_field").val(),
          color_background: $("#background_field").val(),
          color_border: $("#border_field").val(),
          color_active_background: $("#active_background_field").val(),
          color_text: $("#text_field").val(),
          icon: $(".chzn-select-icon").val(),
          custom_color: $("#custom").is(':checked')
        },

        done:function() {
        },

        success: function (data) {
          $('#button_' + '<%= action.id %>').remove();
          $("#panel").append(data);
          closeModal();
          toastr.info('A action has been updated!', 'Action');
        },

        error: function (xhr) {
          $("#errors_container").html('<p class="bg-danger">' + xhr.responseText + '</p>');
          //bootstrap_alert['danger'](xhr.responseText, 5000);
        }
      });

    }
  }

</script>
