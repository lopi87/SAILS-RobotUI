<!-- Modal Upload icon -->
<div class="modal fade" id="writeModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Upload icon</h4>
      </div>
      <div class="modal-body">
        <label for="question"><%= i18n("filesmallerthan %s","42") %></label>
        <form id="new_icon" enctype="multipart/form-data" method="post">
          <div class="fileinput fileinput-new input-group" data-provides="fileinput">
            <div class="form-control" data-trigger="fileinput"><i class="glyphicon glyphicon-file fileinput-exists"></i> <span class="fileinput-filename"></span></div>
            <span id="input_icon" class="input-group-addon btn btn-default btn-file"><span class="fileinput-new">Select file</span><span class="fileinput-exists">Change</span><input type="file" name="iconfile" data-parsley-filemaxmegabytes="42" data-parsley-trigger="change" data-parsley-filemimetypes="image/jpeg, image/png" required=""></span>
            <a id="remove_iconfile_input" href="#" class="input-group-addon btn btn-default fileinput-exists" data-dismiss="fileinput">Remove</a>
          </div>
          <input id="icon_csrf" type="hidden" name="_csrf" value="<%= _csrf %>"/>
        </form>
        <script type="text/javascript">
          $('#new_icon').parsley().on('field:validated', function() {
            var ok = $('.parsley-error').length === 0;
          })
        </script>


        <script type="text/javascript">
          //MUY IMPORTANTE SUBIR CON AJAX FILES
          //http://www.desarrolloweb.com/articulos/upload-archivos-ajax-jquery.html

          $("#new_icon").submit(function(e){
            e.preventDefault();
            var f = $(this);
            var formData = new FormData(document.getElementById("new_icon"));
            formData.append("dato", "valor");

            $.ajax({
              url: '/icon/create/' + '<%= interface.id %>',
              type: 'POST',
              cache: false,
              dataType: 'json',
              processData: false, // Don't process the files
              contentType: false, // Set content type to false as jQuery will tell the server its a query string request
              data: formData,
              beforeSend: function(xhr, settings){
                xhr.setRequestHeader('X-CSRF-Token', $("#icon_csrf").val());
              },
              done:function() {
              },
              success: function(data){

                alert('success');

                if(typeof data.error === 'undefined')
                {
                  console.log('SUCCESS: ' + data.success);
                  bootstrap_alert['success']('A new icon has been uploaded!', 3000 );

                  //limpiar el input
                  $("#remove_iconfile_input").trigger('click');

                  //AÃ±adir el nuevo icono al chosen select
                  //

                }
                else
                {
                  // Handle errors here
                  console.log('ERRORS: ' + data.error);
                }
              }
            });
          });
        </script>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-success" onclick='$("#new_icon").submit()' >upload icon</button>
      </div>
    </div>
  </div>
</div>


